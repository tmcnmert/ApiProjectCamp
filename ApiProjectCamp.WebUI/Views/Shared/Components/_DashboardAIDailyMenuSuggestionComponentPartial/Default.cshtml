@model List<MenuSuggestionDto>

<div class="col-md-6 col-lg-12 col-xl-6">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4>AI Daily Menus</h4>

            <form class="card-header-form">
                <input type="text" name="search" class="form-control" placeholder="Search in menus...">
            </form>
        </div>

        <div class="card-body" id="menu-card-body">

            @foreach (var menu in Model)
            {
                <div class="support-ticket media pb-1 mb-3">

                    <img src="https://flagsapi.com/@(menu.CountryCode)/flat/64.png"
                         class="user-img mr-2"
                         alt="flag">

                    <div class="media-body ml-3">

                        <div class="badge badge-pill badge-primary mb-1 float-right">
                            @menu.Cuisine
                        </div>

                        <span class="font-weight-bold">@menu.MenuTitle</span>

                        <a href="javascript:void(0)">Today's Menu</a>

                        <p class="my-1">
                            <ul class="pl-3">
                                @foreach (var item in menu.Items)
                                {
                                    <li>
                                        <strong>@item.Name</strong> – @item.Description
                                        <span class="text-muted">(₺@item.Price)</span>
                                    </li>
                                }
                            </ul>
                        </p>

                        <small class="text-muted">
                            Generated by <span class="font-weight-bold font-13">AI Chef</span>
                            &nbsp;&nbsp; - @DateTime.Now.ToString("dd MMM yyyy")
                        </small>

                    </div>
                </div>
            }

        </div>

        <a href="javascript:void(0)"
           onclick="refreshMenus(); return false;"
           class="card-footer card-link text-center small">
            Refresh Menus 🔄
        </a>

    </div>
</div>

<script>
    function refreshMenus() {
        // Mevcut sayfayı yeniden yükle ama sadece bu bölümü güncelle
        var currentUrl = window.location.href;

        // Loading göster
        $('#menu-card-body').html(
            '<div class="text-center py-5">' +
            '<i class="fas fa-spinner fa-spin fa-2x text-primary"></i>' +
            '<p class="mt-2">Menüler yenileniyor...</p>' +
            '</div>'
        );

        $.ajax({
            url: currentUrl,
            type: 'GET',
            success: function(response) {
                // Gelen HTML'den sadece menu-card-body içeriğini çıkar
                var newContent = $(response).find('#menu-card-body').html();

                if (newContent) {
                    $('#menu-card-body').html(newContent);
                } else {
                    // Bulamazsa tüm sayfayı yenile
                    location.reload();
                }
            },
            error: function() {
                $('#menu-card-body').html(
                    '<div class="alert alert-danger m-3">' +
                    '<i class="fas fa-exclamation-triangle"></i> ' +
                    'Menüler yenilenirken bir hata oluştu! Lütfen tekrar deneyin.' +
                    '</div>'
                );
            }
        });
    }
</script>
